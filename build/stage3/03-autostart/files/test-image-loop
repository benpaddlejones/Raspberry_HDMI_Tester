#!/bin/bash
# Test Script 1: Loop image-test.webm with optimized resolution (no OSD)

VIDEO_FILE="/opt/hdmi-tester/image-test.webm"

echo "========================================="
echo "Image Test Loop (Optimized Resolution)"
echo "========================================="
echo "File: ${VIDEO_FILE}"
echo "Press Ctrl+C to stop"
echo ""

# Check if video file exists
if [ ! -f "${VIDEO_FILE}" ]; then
    echo "‚ùå ERROR: Video file not found at ${VIDEO_FILE}"
    exit 1
fi

# Run mpv with Raspberry Pi specific flags:
# --loop=inf - Loop forever
# --no-osd-bar - No on-screen display
# --osd-level=0 - Disable all OSD
# --no-input-default-bindings - Disable default key bindings for clean display
# --hwdec=no - Disable hardware decoding (software more stable for MP4)
# --vo=drm - Direct rendering mode (framebuffer, no X11)
# --drm-connector=HDMI-A-1 - Explicitly use HDMI output
# --cache=yes --demuxer-max-bytes=100M - Large buffer to prevent stalls
# --no-config - Ignore user config files that might cause issues
exec mpv --loop=inf --no-osd-bar --osd-level=0 --no-input-default-bindings \
    --hwdec=no --vo=drm --drm-connector=HDMI-A-1 \
    --cache=yes --demuxer-max-bytes=100M --no-config \
    "${VIDEO_FILE}"

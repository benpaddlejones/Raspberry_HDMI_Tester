#!/bin/bash
# Test Script 3: Play both videos in sequence and loop

IMAGE_VIDEO="/opt/hdmi-tester/image-test.webm"
COLOR_VIDEO="/opt/hdmi-tester/color_test.webm"

echo "========================================="
echo "Combined Test Loop"
echo "========================================="
echo "Sequence:"
echo "  1. Image test (optimized resolution)"
echo "  2. Color test (fullscreen stretched)"
echo "  3. Loop forever"
echo ""
echo "Press Ctrl+C to stop"
echo ""

# Check if video files exist
if [ ! -f "${IMAGE_VIDEO}" ]; then
    echo "❌ ERROR: Image video not found at ${IMAGE_VIDEO}"
    exit 1
fi

if [ ! -f "${COLOR_VIDEO}" ]; then
    echo "❌ ERROR: Color video not found at ${COLOR_VIDEO}"
    exit 1
fi

# Loop forever with Raspberry Pi optimized flags
while true; do
    echo "Playing: image-test.webm (optimized resolution)..."
    mpv --no-osd-bar --osd-level=0 \
        --hwdec=no --vo=drm --drm-connector=HDMI-A-1 \
        --cache=yes --demuxer-max-bytes=100M --no-config \
        "${IMAGE_VIDEO}" 2>/dev/null

    echo "Playing: color_test.webm (fullscreen stretched)..."
    mpv --fs --no-keepaspect --no-osd-bar --osd-level=0 \
        --hwdec=no --vo=drm --drm-connector=HDMI-A-1 \
        --cache=yes --demuxer-max-bytes=100M --no-config \
        "${COLOR_VIDEO}" 2>/dev/null

    echo "Restarting loop..."
done
